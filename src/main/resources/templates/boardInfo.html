<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>게시판</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script th:inline="javascript">
    document.addEventListener("DOMContentLoaded", function () {
      const loginElement = document.getElementById('loginMember_email');
      const inputIdElement = document.getElementById('input_id');

      // 전역 함수 등록
      window.opList = function () {
        window.location.href = "/board";
      };

      window.updateBoardPage = function () {
        if (inputIdElement && inputIdElement.value) {
          const boardId = inputIdElement.value;
          window.location.href = "/board/update/" + boardId;
        } else {
          alert("유효한 게시글 ID가 없습니다.");
        }
      };

      window.boardDelete = function () {
        if (loginElement && loginElement.value) {
          const isConfirmed = confirm("정말로 삭제하시겠습니까?");
          if (isConfirmed) {
            const boardId = inputIdElement.value;
            const loginEmail = loginElement.value;

            const dto = {
              boardId: boardId,
              memberDto: {
                email: loginEmail
              }
            };

            $.ajax({
              url: "/delete",
              method: "DELETE",
              contentType: "application/json",
              data: JSON.stringify(dto),
              success: function () {
                alert("삭제 완료");
                window.location.href = "/board";
              },
              error: function (xhr) {
                if (xhr.status === 403) {
                  alert("권한이 없습니다.");
                } else if (xhr.status === 404) {
                  alert("게시글을 찾을 수 없습니다.");
                } else {
                  alert("삭제 중 오류가 발생했습니다.");
                }
              }
            });
          }
        } else {
          alert("로그인 상태에서만 삭제할 수 있습니다.");
        }
      };
    });
  </script>

</head>

<body>
<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
    <a class="navbar-brand" href="#" th:href="@{/}">게시판</a>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <div th:if="${loginMember != null}" class="d-flex justify-content-between">
        <div class="nav-item">
          <a class="nav-link active" aria-current="page" th:text="${loginMember != null ? '사용자: ' + loginMember.email : '로그인'}">Home</a>
        </div>
        <div class="nav-item">
          <form th:action="@{/logout}" method="post">
            <button type="submit" class="btn btn-link">로그아웃</button>
          </form>
        </div>
        </div>
        <div th:if="${loginMember==null}" class="d-flex justify-content-between">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" th:href="@{/login}">로그인</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" th:href="@{/createMember}">회원가입</a>
          </li>
        </div>
      </ul>
    </div>
  </div>
</nav>

<div th:object="${board}">

<div class="container mt-4">
  <div class="block table-responsive grid-view">
    <table class="table table-bordered">
      <hr class="my-4"/>
      <colgroup>
        <col>
        <col style="width: 15%">
        <col>
      </colgroup>
      <thead>
      <tr>
        <th colspan="4">
          <div class="col-md-12">
            <span id="text_title" th:text="*{title}"></span>
            <button type="button" class="btn" onclick="updateBoardPage()">수정</button>
            <button type="button" class="btn btn-danger" onclick="boardDelete()">삭제</button>
            <button type="button" class="btn btn-info" onclick="opList()">목록</button>
          </div>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <th>등록자명</th>
        <td th:text="*{writer}"></td>
        <th>등록일</th>
        <td th:text="${#temporals.format(board.dateTime, 'yyyy-MM-dd')}">2024-11-20 18:38:11</td>
      </tr>
      <tr>
        <th>조회수</th>
        <td colspan="3" th:text="*{views}">5</td>
      </tr>
      <tr>
        <td colspan="4">
          <div class="col-md-9 board-contents" th:text="*{content}"></div>
        </td>
      </tr>
      </tbody>
    </table>
    <hr class="my-4"/>
  </div>
</div>
  <input type="hidden" id="input_id" th:value="*{boardId}">
  <input th:if="${loginMember != null}" type="hidden" id="loginMember_email" th:value="${loginMember.email}">
</div>
</body>
</html>